@model LPA.Dashboard.Web.DeploymentViewModel
@{
    ViewBag.Title = "Deployment";
    ViewBag.ActiveTab = "Deployment";
    var lastRegion = WOW.IllustrationMgmntTool.Common.Code.DeploymentRegion.Test;
    string[] devRegions = { "Beta", "Test" };
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0-alpha14/css/tempusdominus-bootstrap-4.min.css" />
@functions{
    string GetRegionName(int id)
    {
        return Model.DeploymentRegions.Where(dr => dr.DeploymentRegionId == id).First().Name;
    }
}
@section Scripts{
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/Scripts/alert.js")
    @Scripts.Render("~/bundles/datetime")
    @Scripts.Render("~/Scripts/custom/common.js")


    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script>
        var regions = @Html.Raw(Json.Encode(Model.DeploymentRegions));
        var selectedDate = new Date();
        var currentDeployment;

        $('body').on('DOMNodeInserted', '#datetimepicker3', function () {
            if (!$("#datetimepicker3").hasClass('added')) {
                $("#datetimepicker3").addClass("added");
                $("#datetimepicker3").datetimepicker({
                    inline: true,
                    sideBySide: true,
                    minDate: new Date()
                });
            }
        });
        $('body').on('change.datetimepicker', '#datetimepicker3', function (event) {
            selectedDate = event.date; //
            //$('#date').text(moment(event.date).format('MM/DD/YYYY h:mm a'));
            $('#date').text(moment(event.date).format('dddd, MMMM Do, YYYY h:mm A'));

        });



        $(document).ready(function () {
            var errorMessage = "@Model.ErrorMessage";

            if (errorMessage != "")
                AddDismissableAlert(errorMessage, "danger");

            var regions = @Html.Raw(Json.Encode(Model.DeploymentRegions));
            var updates = @Html.Raw(Json.Encode(Model.ResourceDeployments));

            console.log(updates);

            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            });

            $.ajaxSetup({
                beforeSend: function (xhr) {
                    xhr.withCredentials = true;
                }
            });
            $('.MarkDeploymentAsFailure').click(function () {
                var id = $(this).data('id');

                ShowDialog("Are you sure", "<strong class='text-danger'>WARNING</strong> Marking an update as a failure can not be undone.", function () {
                    $.ajax({
                        type: "GET",
                        url: "api/@Url.Action("MarkDeploymentAsFailure", "DeploymentManagement")?id=" + id,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        complete: function (data) {
                            console.log(data);
                            if (data.status == 200) {
                                AddDismissableAlert("Sucessfully marked test as failure", "success");
                                $("#" + id + "-i").removeAttr('class');
                                $("#" + id + "-i").addClass("fas fa-times fa-3x text-danger");
                                $("#" + id + "-buttons").hide();
                            }
                            else {
                                AddDismissableAlert("Unable to mark deployment as failure", "danger")
                            }
                        }
                    });
                });
            });

            $('.ScheduleDeployment').click(function () {
                var id = $(this).data('id');

                ShowDialog("Are you sure", "Deploying to a higher region can't be undone. <p class='modal-remove'>This change will go into effect <strong><label class='text-danger' id='date'></label></strong></p> <div class='modal-remove' id='datetimepicker3'></div> ", function () {
                    var input = {
                        Id: id,
                        Date: selectedDate
                    };
                    var DTO = JSON.stringify(input);
                    $.ajax({
                        type: "POST",
                        url: "api/@Url.Action("ScheduleDeployment", "DeploymentManagement")",
                        data: DTO,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        crossDomain: true,
                        complete: function (data) {
                            console.log(data);
                            if (data.status == 200) {
                                location.reload();
                            }
                            else {
                                AddDismissableAlert("Unable to schedule deployment. " + data.responseText, "danger")
                            }
                        }
                    });
                });
            });


            var setVersionAndChecklist = function () {
                var selectedRegion = $("#region").val();
                var checklistSelect = $("#checklist");
                checklistSelect.empty();

                if (selectedRegion != null && selectedRegion != '' && selectedRegion != 0) {
                    $("#version").val(GetNewVersion($("#region option:selected").text()));
                    $("#version").effect("highlight", { color: "#c0d8ef" }, 3000);

                    $.getJSON('@Url.Action("GetChecklists")', { regionId: selectedRegion }, function (checklists) {
                        if (checklists != null && !jQuery.isEmptyObject(checklists)) {
                            if (checklists.length > 1) {
                                checklistSelect.append($('<option/>', {
                                    value: null,
                                    text: ""
                                }));
                            }
                            $.each(checklists, function (index, checklist) {
                                checklistSelect.append($('<option/>', {
                                    value: checklist.Id,
                                    text: checklist.TemplateName
                                }));
                            });
                        }
                        else {
                            checklistSelect.append($('<option/>', {
                                value: null,
                                text: "No Checklist available...."
                            }));
                        };
                    });
                }
            };

            $('#deploynext').on('click', setVersionAndChecklist);
            $('#region').on('change', setVersionAndChecklist);
        });

        $(document).ready(function () {
            $('.DeleteChecklist').click(function (e) {
                currentDeployment = $(this).data('id');
                $("#deleteChecklistModal").modal('show');
            });

            $('.CancelDeleteChecklist').click(function () {
                var validator = $("#deleteChecklistForm").validate();
                validator.resetForm();
                $("#deleteChecklistModal").modal('hide');
            });

            $("#deleteChecklistForm").validate({
                rules: {
                    inputWikiPassword: {
                        required: true
                    }
                },
                messages: {
                    inputWikiPassword: {
                        required: "Please enter your Wiki password"
                    }
                },
                submitHandler: function (form) {
                    var input = {
                        Deployment: currentDeployment,
                        WikiPassword: inputWikiPassword.value
                    };

                    var ResourceUpdateModelDTO = JSON.stringify(input);

                    unloadDeleteChecklistModal();
                    $("#busySpinner").removeClass("hiddenSpinner");

                    $.ajax({
                        type: "POST",
                        url: "/Deployment/DeleteChecklist",
                        data: ResourceUpdateModelDTO,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            if (data.success) {
                                location.reload();
                            }
                            else {
                                localStorage.setItem("dismissibleAlert", data.message);
                                localStorage.setItem("alertType", "danger");
                                location.reload();
                                console.log(data.message);
                            }
                        },
                        error: function (data) {
                            AddDismissableAlert(`${data.responseText}`, "danger")
                            $("#busySpinner").addClass("hiddenSpinner");
                        }
                    });
                }
            });

        });

        $(document).ready(function () {

            $('.CreateChecklist').click(function (e) {
                currentDeployment = $(this).data('id');
                var selectChecklist = $("#selectChecklist");
                selectChecklist.empty();

                $.getJSON('@Url.Action("GetChecklists")', { regionId: currentDeployment.Region }, function (checklists) {
                    if (checklists != null && !jQuery.isEmptyObject(checklists)) {
                        if (checklists.length > 1) {
                            selectChecklist.append($('<option/>', {
                                value: "",
                                text: ""
                            }));
                        }
                        $.each(checklists, function (index, checklist) {
                            selectChecklist.append($('<option/>', {
                                value: checklist.Id,
                                text: checklist.TemplateName
                            }));
                        });
                    }
                    else {
                        selectChecklist.append($('<option/>', {
                            value: null,
                            text: "No Checklist available...."
                        }));
                    };
                });

                $("#createChecklistModal").modal('show');
            });

            $('.CancelCreateChecklist').click(function () {
                var validator = $("#createChecklistForm").validate();
                validator.resetForm();
                $("#createChecklistModal").modal('hide');
            });

            $("#createChecklistForm").validate({
                rules: {
                    selectChecklist: {
                        required: true
                    },
                    inputCreateWikiPassword: {
                        required: true
                    }
                },
                messages: {
                    selectChecklist: {
                        required: "Please select a checklist"
                    },
                    inputCreateWikiPassword: {
                        required: "Please enter your Wiki password"
                    }
                },
                submitHandler: function (form) {
                    var selectedChecklist = $("#selectChecklist").val();

                    var input = {
                        Deployment: currentDeployment,
                        ChecklistId: selectedChecklist,
                        WikiPassword: inputCreateWikiPassword.value
                    };
                    var ResourceUpdateModelDTO = JSON.stringify(input);

                    unloadCreateChecklistModal();
                    $("#busySpinner").removeClass("hiddenSpinner");

                    $.ajax({
                        type: "POST",
                        url: "/Deployment/CreateChecklist",
                        data: ResourceUpdateModelDTO,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            if (data.success) {
                                location.reload();
                            }
                            else {
                                localStorage.setItem("dismissibleAlert", data.message);
                                localStorage.setItem("alertType", "danger");
                                location.reload();
                                console.log(data.message);
                            }
                        },
                        error: function (data) {
                            AddDismissableAlert(`${data.responseText}`, "danger");
                            $("#busySpinner").addClass("hiddenSpinner");
                        }
                    });
                }
            });


        });

        $(document).ready(function () {
            $('.DeleteDeployment').click(function (e) {
                currentDeployment = $(this).data('id');
                $("#deleteDeploymentModal").modal('show');
            });

            $('.CancelDeleteDeployment').click(function () {
                var validator = $("#deleteDeploymentForm").validate();
                validator.resetForm();
                $("#deleteDeploymentModal").modal('hide');
            });

            $("#deleteDeploymentForm").validate({
                rules: {
                    inputDeleteDeployWikiPassword: {
                        required: true
                    }
                },
                messages: {
                    inputDeleteDeployWikiPassword: {
                        required: "Please enter your Wiki password"
                    }
                },
                submitHandler: function (form) {
                    var input = {
                        Deployment: currentDeployment,
                        WikiPassword: inputDeleteDeployWikiPassword.value
                    };

                    var ResourceUpdateModelDTO = JSON.stringify(input);

                    unloadDeleteDeploymentModal();
                    $("#busySpinner").removeClass("hiddenSpinner");

                    $.ajax({
                        type: "POST",
                        url: "/Deployment/DeleteDeployment",
                        data: ResourceUpdateModelDTO,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            if (data.success) {
                                location.reload();
                            }
                            else {
                                localStorage.setItem("dismissibleAlert", data.message);
                                localStorage.setItem("alertType", "danger");
                                location.reload();
                                console.log(data.message);
                            }

                            //unloadDeleteDeploymentModal();
                        },
                        error: function (data) {
                            AddDismissableAlert(`${data.responseText}`, "danger");
                            $("#busySpinner").addClass("hiddenSpinner");
                            //unloadDeleteDeploymentModal();
                        }
                    });
                }
            });

        });


        $(document).ready(function () {

            $('.EditDeployment').click(function (e) {
                currentDeployment = $(this).data('id');
                var selectChecklist = $("#selectNewChecklist");
                selectChecklist.empty();

                $.getJSON('@Url.Action("GetChecklists")', { regionId: currentDeployment.Region }, function (checklists) {
                    if (checklists != null && !jQuery.isEmptyObject(checklists)) {
                        if (checklists.length > 1) {
                            selectChecklist.append($('<option/>', {
                                value: "",
                                text: ""
                            }));
                        }
                        $.each(checklists, function (index, checklist) {
                            selectChecklist.append($('<option/>', {
                                value: checklist.Id,
                                text: checklist.TemplateName
                            }));
                        });
                    }
                    else {
                        selectChecklist.append($('<option/>', {
                            value: null,
                            text: "No Checklist available...."
                        }));
                    };
                });

                $("#editDeploymentModal").modal('show');
            });

            $('.CancelEditDeployment').click(function () {
                var validator = $("#editDeploymentForm").validate();
                validator.resetForm();
                $("#editDeploymentModal").modal('hide');
            });

            $("#editDeploymentForm").validate({
                rules: {
                    inputEditDeploymentScheduled: {
                        required: true
                    },
                    selectNewChecklist: {
                        required: true
                    },
                    inputEditWikiPassword: {
                        required: true
                    }
                },
                messages: {
                    inputEditDeploymentScheduled: {
                        required: "Please enter a new deployment date"
                    },
                    selectNewChecklist: {
                        required: "Please select a new checklist"
                    },
                    inputEditWikiPassword: {
                        required: "Please enter your Wiki password"
                    }
                },
                submitHandler: function (form) {
                    var selectedChecklist = $("#selectNewChecklist").val();

                    var input = {
                        Deployment: currentDeployment,
                        ChecklistId: selectedChecklist,
                        WikiPassword: inputEditWikiPassword.value
                    };

                    input.Deployment.DeploymentScheduled = inputEditDeploymentScheduled.value;

                    var ResourceUpdateModelDTO = JSON.stringify(input);

                    unloadEditDeploymentModal();
                    $("#busySpinner").removeClass("hiddenSpinner");

                    $.ajax({
                        type: "POST",
                        url: "/Deployment/EditDeployment",
                        data: ResourceUpdateModelDTO,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            if (data.success) {
                                location.reload();
                            }
                            else {
                                localStorage.setItem("dismissibleAlert", data.message);
                                localStorage.setItem("alertType", "danger");
                                location.reload();
                                console.log(data.message);
                            }
                        },
                        error: function (data) {
                            AddDismissableAlert(`${data.responseText}`, "danger");
                            $("#busySpinner").addClass("hiddenSpinner");
                        }
                    });
                }
            });
        });

        $(document).ready(function () {
            $('.ExecuteDeployment').click(function (e) {
                currentDeployment = $(this).data('id');

                var input = {
                    Deployment: currentDeployment
                };

                var ResourceUpdateModelDTO = JSON.stringify(input);

                $("#busySpinner").removeClass("hiddenSpinner");

                $.ajax({
                    type: "POST",
                    url: "/Deployment/ExecuteDeployment",
                    data: ResourceUpdateModelDTO,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.success) {
                            localStorage.setItem("dismissibleAlert", data.message);
                            localStorage.setItem("alertType", "success");
                            location.reload();
                        }
                        else {
                            localStorage.setItem("dismissibleAlert", data.message);
                            localStorage.setItem("alertType", "danger");
                            location.reload();
                            console.log(data.message);
                        }
                    },
                    error: function (data) {
                        AddAlert(`${data.responseText}`, "danger", 3000);
                        $("#busySpinner").addClass("hiddenSpinner");

                    }
                });
            });

        });

        $(document).ready(function () {
            var alertMessage = localStorage.getItem("dismissibleAlert");
            var alertType = localStorage.getItem("alertType");
            if (alertMessage != null) {
                AddDismissableAlert(`${alertMessage}`, alertType);
            }
            localStorage.removeItem("dismissibleAlert");
            localStorage.removeItem("alertType");

            $("#busySpinner").addClass("hiddenSpinner");
        })

        function unloadDeleteChecklistModal() {
            inputWikiPassword.value = "";
            currentDeployment = null;
            $("#deleteChecklistModal").modal('hide');
        };

        function unloadCreateChecklistModal() {
            $('#selectChecklist').empty();
            inputCreateWikiPassword.value = "";
            currentDeployment = null;
            $("#createChecklistModal").modal('hide');
        };

        function unloadDeleteDeploymentModal() {
            inputDeleteDeployWikiPassword.value = "";
            currentDeployment = null;
            $("#deleteDeploymentModal").modal('hide');
        };

        function unloadEditDeploymentModal() {
            $('#selectNewChecklist').empty();
            inputEditWikiPassword.value = "";
            inputEditDeploymentScheduled.value = "";
            currentDeployment = null;
            $("#editDeploymentModal").modal('hide');
        };

        $(function () {
            // Reference the auto-generated proxy for the hub.
            var status = $.connection.deploymentStatusHub;
            // Create a function that the hub can call back to display messages.
            status.client.addDeploymentStatus = function (message) {
                // Add the message to the page.
                var messageList = $('#statusMessages');
                messageList.append('<li><strong>' + htmlEncode(message) + '...</strong></li>');
                messageList.animate({ scrollTop: messageList[0].scrollHeight }, 500);
                //messageList.animate({ scrollTop: messageList.scrollHeight }, 500);

                //AddDismissableAlert(message, 'success')
            };
            // Start the connection.
            $.connection.hub.start().done(function () {
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}

<style>
    .listview {
        display: flex;
    }

    .list {
        /*width: 100%;*/
        display: grid;
        grid-template-columns: 10% 85% 5%;
    }

    .error {
        color: red;
    }

    .scroll-hide {
        width: 600px;
        height: 300px;
        overflow-y: scroll;
        text-align: left;
        justify-content: center;
        color: #003750;
    }

        .scroll-hide::-webkit-scrollbar {
            display: none;
        }

    /* Hide scrollbar for IE, Edge and Firefox */
    .scroll-hide {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
    }

    .status-box {
        margin-left: auto;
        margin-right: auto;
        display: table;
    }
</style>

<div class="modal fade" tabindex="-1" id="deleteChecklistModal"
     data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Delete Checklist</h4>
                <button type="button" class="close" data-dismiss="modal">
                    ×
                </button>
            </div>
            <div class="modal-body">
                <form role="form" id="deleteChecklistForm">
                    <h5 class="mb-0 text-primary">Are you sure you want to delete the deployment checklist?  This <strong class='text-danger'>cannot</strong> be undone.</h5>
                    <p></p>
                    <div class="form-group">
                        <label for="inputWikiPassword" class="control-label">Wiki Password</label>
                        <input class="form-control" placeholder="Wiki Password" type="password" id="inputWikiPassword" name="inputWikiPassword" />
                        <div class="invalid-feedback">
                            Please enter your Wiki password.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" id="btnDeleteChecklist" class="btn btn-primary button button4 SubmitDeleteChecklist"><i class="fas fa-check"></i> Yes</button>
                        <button type="button" id="btnCancelDeleteChecklist" class="btn btn-secondary button button4 CancelDeleteChecklist"><i class="fas fa-ban"></i> No</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" tabindex="-1" id="createChecklistModal"
     data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Create Checklist</h4>
                <button type="button" class="close" data-dismiss="modal">
                    ×
                </button>
            </div>
            <div class="modal-body">
                <form role="form" id="createChecklistForm">
                    <div class="form-group">
                        <label for="selectChecklist" class="control-label">Checklist</label>
                        <select id="selectChecklist" name="selectChecklist" class="form-control">
                            <option value="">-- Select --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inputCreateWikiPassword" class="control-label">Wiki Password</label>
                        <input class="form-control" placeholder="Wiki Password" type="password" id="inputCreateWikiPassword" name="inputCreateWikiPassword" />
                    </div>
                    <div class="modal-footer">
                        <button type="submit" id="btnCreateChecklist" class="btn btn-primary SubmitCreateChecklist"><i class="fas fa-save"></i> Submit</button>
                        <button type="button" id="btnCancelCreateChecklist" class="btn btn-secondary CancelCreateChecklist"><i class="fas fa-ban"></i> Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" tabindex="-1" id="deleteDeploymentModal"
     data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Delete Deployment</h4>
                <button type="button" class="close" data-dismiss="modal">
                    ×
                </button>
            </div>
            <div class="modal-body">
                <form role="form" id="deleteDeploymentForm">
                    <h5 class="mb-0 text-primary">Are you sure you want to delete this deployment?  This <strong class='text-danger'>cannot</strong> be undone.</h5>
                    <p></p>
                    <div class="form-group">
                        <label for="inputDeleteDeployWikiPassword" class="control-label">Wiki Password</label>
                        <input class="form-control" placeholder="Wiki Password" type="password" id="inputDeleteDeployWikiPassword" name="inputDeleteDeployWikiPassword" />
                    </div>
                    <div class="modal-footer">
                        <button type="submit" id="btnDeleteDeployment" class="btn btn-primary SubmitDeleteDeployment"><i class="fas fa-check"></i> Yes</button>
                        <button type="button" id="btnCancelDeleteDeployment" class="btn btn-secondary CancelDeleteDeployment"><i class="fas fa-ban"></i> No</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" tabindex="-1" id="editDeploymentModal"
     data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Edit Deployment</h4>
                <button type="button" class="close" data-dismiss="modal">
                    ×
                </button>
            </div>
            <div class="modal-body">
                <form role="form" id="editDeploymentForm">
                    <h5 class="mb-0 text-primary">Are you sure you want to change the deployment date?  This <strong class='text-danger'>cannot</strong> be undone.</h5>
                    <p></p>
                    <div class="form-group">
                        <label for="inputEditDeploymentScheduled" class="control-label">New Deployment Date</label>
                        <input class="form-control datepicker" type="date" placeholder="Wiki Password" id="inputEditDeploymentScheduled" name="inputEditDeploymentScheduled" />
                    </div>
                    <div class="form-group">
                        <label for="selectNewChecklist" class="control-label">New Checklist</label>
                        <select id="selectNewChecklist" name="selectNewChecklist" class="form-control">
                            <option value="">-- Select --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inputEditWikiPassword" class="control-label">Wiki Password</label>
                        <input class="form-control" placeholder="Wiki Password" type="password" id="inputEditWikiPassword" name="inputEditWikiPassword" />
                    </div>
                    <div class="modal-footer">
                        <button type="submit" id="btnEditDeployment" class="btn btn-primary SubmitEditDeployment"><i class="fas fa-check"></i> Yes</button>
                        <button type="button" id="btnCancelEditDeployment" class="btn btn-secondary CancelEditDeployment"><i class="fas fa-ban"></i> No</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div id="busySpinner">
    <div class="spinner-border text-primary" role="status">
        <span class="sr-only spinner">Loading...</span>
    </div>
    <div class="status-box">
        <ul id="statusMessages" class="scroll-hide">
        </ul>
    </div>
</div>

<div class="card my-4" style="display:flex;">
    <div class="card-body">
        <div>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12 d-flex flex-row">
                        <h5 class="text-muted mb-2 mt-auto mr-auto">
                            Remote System Updates
                        </h5>
                        <a href="@Url.Action("Create", "Deployment")" class="btn btn-primary mb-2 add-agent">
                            <i class="fas fa-plus"></i>
                        </a>
                    </div>
                </div>
                <hr class="mt-0" />
                <div id="alert" class="alert" role="alert" style="display:none;">
                </div>
                @foreach (var item in Model.ResourceDeployments)
                {
                    <div class="row">
                        <div class="list">
                            <div class="" style="display: flex; align-items: center; justify-content: center;">
                                @if ((int)item.Status == 0)
                                {
                                    <i id="@item.Id-i" class="fas fa-check fa-3x text-success"></i>
                                }
                                @if ((int)item.Status == 1)
                                {
                                    <i id="@item.Id-i" class="fas fa-times fa-3x text-danger"></i>
                                }
                                @if ((int)item.Status == 2)
                                {
                                    <i id="@item.Id-i" class="far fa-clock fa-3x text-warning"></i>
                                }
                                @if ((int)item.Status == 3)
                                {
                                    <i id="@item.Id-i" class="fas fa-sync fa-3x text-warning"></i>
                                }
                            </div>
                            <div>
                                <div>
                                    <h5 class="mb-0">@item.Title </h5>
                                    <p class="mb-0">@item.Description</p>
                                    <p class="mb-0 text-muted">@item.CreatedBy</p>
                                    @foreach (var deployment in item.Deployments)
                                    {
                                        {
                                            lastRegion = (WOW.IllustrationMgmntTool.Common.Code.DeploymentRegion)deployment.Region + 1;
                                        }

                                        <p class="mb-0 text-muted font-italic">

                                            @(deployment.Version == "" ? "A Version is" : $"Version " )<strong>@deployment.Version</strong> scheduled for deployment on <strong>@deployment.DeploymentScheduled</strong> to <strong>@GetRegionName(deployment.Region)</strong>.  Created on @string.Format("{0:dddd, MMMM d, yyyy 'at' h:mm tt}", deployment.DeploymentDate) by <strong>@deployment.DeployedBy</strong>
                                            <button type='button' data-id="@deployment" class='btn btn-image DeleteDeployment' data-toggle="tooltip" data-target="#deleteDeployment" title="Delete Deployment" data-placement="left">
                                                <span class='fas fa-calendar-minus fa-lg' aria-hidden='true'></span>
                                            </button>
                                            <button type='button' data-id="@deployment" class='btn btn-image EditDeployment' data-toggle="tooltip" data-target="#editDeployment" title="Edit Deployment" data-placement="left">
                                                <span class='fas fa-calendar-check fa-lg' aria-hidden='true'></span>
                                            </button>

                                            @if ((@deployment.Status?.Equals("READY", StringComparison.OrdinalIgnoreCase) ?? true) && (User.IsInRole("HOAD\\WindowsServerAdmins") || (User.IsInRole("HOAD\\GRP_LPA_Devs") && devRegions.Contains(@GetRegionName(deployment.Region)))))
                                            {
                                                //Disabled this button until we get this deployed to a server with valid accounts
                                                @*<button type='button' data-id="@deployment" class='btn btn-image ExecuteDeployment' data-toggle="tooltip" data-target="#executeDeployment" title="Execute Deployment" data-placement="left" disabled="@(!(deployment.Status.Equals("READY", StringComparison.OrdinalIgnoreCase)))">
                                                        <span class='fas fa-upload fa-lg' aria-hidden='true'></span>
                                                    </button>*@
                                                string style = @deployment.Status?.Equals("COMPLETE", StringComparison.OrdinalIgnoreCase) ?? false ? "font-weight: bold; color:Green" : @deployment.Status?.Equals("ERROR", StringComparison.OrdinalIgnoreCase) ?? false ? "font-weight: bold; color:Red" : "font-weight: bold;";
                                                <label style="@style">@deployment.Status</label>
                                            }
                                            else
                                            {
                                                string style = @deployment.Status?.Equals("COMPLETE", StringComparison.OrdinalIgnoreCase) ?? false ? "font-weight: bold; color:Green" : @deployment.Status?.Equals("ERROR", StringComparison.OrdinalIgnoreCase) ?? false ? "font-weight: bold; color:Red" : "font-weight: bold;";
                                                <label style="@style">@deployment.Status</label>
                                            }


                                        </p>

                                        if (!string.IsNullOrEmpty(deployment.ChecklistDetail))
                                        {
                                            if (!deployment.ChecklistDetail.StartsWith("Error:"))
                                            {
                                                <p class="mb-0 text-muted font-italic">
                                                    Checklist <strong><a href='@deployment.ChecklistUrl' target="_blank">@deployment.ChecklistUrl</a></strong>
                                                    <button id='btnShowModal' type='button' data-id="@deployment" class='btn btn-image btn-sm DeleteChecklist' data-toggle="tooltip" data-placement="left" title="Delete Deployment Checklist"> <span class="fas fa-minus-square fa-lg" aria-hidden='true'></span> </button>
                                                </p>
                                            }
                                            else
                                            {
                                                <p class="mb-0 text-muted font-italic">Checklist Error <strong>@deployment.ChecklistDetail</strong></p>
                                            }
                                        }
                                        else
                                        {
                                            <button id='btnShowCreateModal' type='button' data-id="@deployment" class='btn btn-image btn-sm CreateChecklist' data-toggle="tooltip" data-placement="left" title="Create Deployment Checklist"> <span class="fas fa-plus-square fa-lg" aria-hidden='true'></span> </button>
                                        }
                                    }
                                </div>
                            </div>
                            <div id="@item.Id-buttons" style="display:flex; justify-content: center; align-items: center; flex-direction: column;">
                                @if (item.Status != 0 && (int)item.Status != 1)
                                {
                                    <button type='button' data-id="@item.Id" class='btn DeployToNextRegion' data-toggle="modal" data-target="#deployNextRegion" data-placement="left" id="deploynext" name="deploynext">
                                        <span class='fas fa-arrow-up fa-lg' aria-hidden='true'></span>
                                    </button>

                                    using (Html.BeginForm("DeployNextRegion", "Deployment", FormMethod.Post, new { enctype = "multipart/form-data" }))
                                    {
                                        <div class="modal row" tabindex="-1" role="dialog" id="deployNextRegion">
                                            <div class="col-xl-8 offset-xl-2 col-lg-12">
                                                <div class="card mt-4">
                                                    <div class="card-body">
                                                        <div>
                                                            <div class="container-fluid">
                                                                <div class="row">
                                                                    <div class="col-12">
                                                                        <h5 class="text-muted mb-2">
                                                                            Deployment
                                                                        </h5>
                                                                    </div>
                                                                </div>
                                                                <hr class="mt-0" />
                                                                <div id="alert" class="alert" role="alert" style="display:none;">
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-12">
                                                                        <div class="form-group">
                                                                            <label for="deploymentDate" calss="control-label">Deployment Date</label>
                                                                            @Html.TextBoxFor(m => m.ResourceUpdate.DeploymentScheduled, new { @type = "date", @class = "form-control datepicker", placeholder = "Enter the deployment date." })
                                                                            @Html.ValidationMessageFor(m => m.ResourceUpdate.DeploymentScheduled, "", new { @class = "text-danger" })
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label for="region" class="control-label">Region</label>
                                                                            @Html.HiddenFor(m => m.RSUId, new { id = "rsuId", Value = item.Id })
                                                                            @Html.DropDownListFor(m => m.Region, new SelectList(Model.DeploymentRegions?.OrderBy(o => o.Name), "DeploymentRegionId", "RegionWithVersion"), new { @class = "form-control", name = "region", id = "region" })
                                                                            @Html.ValidationMessageFor(m => m.Region, "", new { @class = "text-danger" })
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label for="version" class="control-label">Deployment Version</label>
                                                                            @Html.EditorFor(m => m.ResourceUpdate.Version, new { htmlAttributes = new { @class = "form-control", @placeholder = "Deployment Version", name = "version", id = "version" } })
                                                                            @Html.ValidationMessageFor(m => m.ResourceUpdate.Version, "", new { @class = "text-danger" })
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label for="checklist" class="control-label">Checklist</label>
                                                                            @Html.DropDownListFor(m => m.ChecklistTemplate, new SelectList(Model.ChecklistTemplates.OrderBy(o => o.Id), "Id", "TemplateName"), new { @class = "form-control", name = "checklist", id = "checklist" })
                                                                            @Html.ValidationMessageFor(m => m.ChecklistTemplate, "", new { @class = "text-danger" })
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label for="wikipw" class="control-label">Wiki Password</label>
                                                                            @Html.PasswordFor(m => m.ResourceUpdate.WikiPassword, new { @class = "form-control", name = "wikipw", id = "wikipw", placeholder = "Enter your password for the Wiki" })
                                                                            @Html.ValidationMessageFor(m => m.ResourceUpdate.WikiPassword, "", new { @class = "text-danger" })
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row my-4">
                                                    <div class="col-lg-6 mb-4">
                                                        <a href='@Url.Action("Index", "Deployment")' class="btn btn-secondary form-control" style="height: 45px; padding: .7rem;"><i class="fas fa-arrow-left"></i> Back</a>
                                                    </div>
                                                    <div class="col-lg-6 mb-4">
                                                        <button type="submit" class="btn btn-primary form-control" style="height: 45px; padding: .7rem;"><i class="fas fa-save"></i> Deploy</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <hr />
                }

            </div>
        </div>
    </div>
</div>
